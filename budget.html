<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Budget Overview</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body { font-family:'Segoe UI', sans-serif; background:#f8f9fa; }
  header { background:#28a745; color:white; padding:15px; position:sticky; top:0; z-index:10; }
  .container { padding:30px 15px; }
  
  /* Update Budget button */
  .update-btn { margin-bottom:20px; }

  /* Summary boxes */
  .summary { display:flex; justify-content:space-around; margin-bottom:30px; flex-wrap:wrap; }
  .summary div { 
      padding:20px 30px; 
      border-radius:15px; 
      text-align:center; 
      box-shadow:0 8px 20px rgba(0,0,0,0.15); 
      transition: transform 0.3s; 
      flex:1; margin:10px; min-width:150px;
  }
  .summary div:hover { transform: scale(1.05); }
  .summary span { font-size:2rem; font-weight:bold; display:block; margin-top:10px; }

  /* Grocery item cards */
  .item-card { 
      background:white; 
      padding:20px; 
      border-radius:15px; 
      box-shadow:0 5px 20px rgba(0,0,0,0.1); 
      margin-bottom:15px; 
      transition: transform 0.3s, box-shadow 0.3s; 
  }
  .item-card:hover { 
      transform: scale(1.02); 
      box-shadow:0 10px 25px rgba(0,0,0,0.2); 
  }
  .item-type { font-size:0.9rem; color:#555; }
</style>
</head>
<body>

<header class="d-flex justify-content-between align-items-center">
  <h4>Budget Overview</h4>
  <button class="btn btn-light btn-sm" onclick="window.location.href='index.html'">üè† Home</button>
</header>

<div class="container">

  <!-- Update Budget -->
  <button class="btn btn-warning update-btn" onclick="updateBudget()">üí∞ Update Budget</button>

  <!-- Summary -->
  <div class="summary">
    <div style="background:#007bff; color:white;">
      Total Budget
      <span id="totalBudget">0</span>
    </div>
    <div style="background:#dc3545; color:white;">
      Spent
      <span id="spent">0</span>
    </div>
    <div style="background:#28a745; color:white;">
      Remaining
      <span id="remaining">0</span>
    </div>
  </div>

  <!-- Grocery items -->
  <div id="groceryList"></div>

</div>

<script>
const apiUrl = "http://localhost:8080/api/grocery"; // Update if needed
let totalBudget = 30000; // default budget

function formatDate(dateStr){
  if(!dateStr) return "N/A";
  const [y,m,d] = dateStr.split("-");
  return `${d}/${m}/${y}`;
}

// Animate numbers
function animateValue(id, start, end, duration) {
  let obj = document.getElementById(id);
  let range = end - start;
  let current = start;
  let increment = range / (duration / 50);
  let timer = setInterval(() => {
      current += increment;
      if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
          current = end;
          clearInterval(timer);
      }
      obj.textContent = Math.floor(current);
  }, 50);
}

// Load budget and items
async function loadBudget() {
  try {
    const res = await fetch(apiUrl);
    const items = await res.json();
    const listContainer = document.getElementById("groceryList");

    if(items.length === 0){
      listContainer.innerHTML = `<p class="text-center">No items added yet.</p>`;
      animateValue("totalBudget", 0, totalBudget, 1000);
      animateValue("spent", 0, 0, 1000);
      animateValue("remaining", 0, totalBudget, 1000);
      return;
    }

    let totalSpent = items.reduce((sum,i)=> sum + (i.price || 0),0);
    let remaining = totalBudget - totalSpent;

    animateValue("totalBudget", 0, totalBudget, 1000);
    animateValue("spent", 0, totalSpent, 1000);
    animateValue("remaining", 0, remaining, 1000);

    listContainer.innerHTML = items.map(i=>`
      <div class="item-card">
        <strong>${i.name || "Unnamed Item"}</strong><br>
        Quantity: ${i.quantity || 1} ${i.unit || ""}<br>
        Price: ‚Çπ${i.price || 0}<br>
        Source: <span class="item-type">${i.source || "N/A"}</span><br>
        Date: ${formatDate(i.date || "")}
      </div>
    `).join("");

  } catch(err){
    console.error(err);
    alert("Failed to load items from backend.");
  }
}

// Update total budget
function updateBudget() {
  let newBudget = prompt("Enter new total budget:", totalBudget);
  if(newBudget !== null && !isNaN(newBudget)){
    totalBudget = parseInt(newBudget);
    loadBudget(); // reload items to update remaining dynamically
  } else {
    alert("Please enter a valid number.");
  }
}

loadBudget();
</script>
</body>
</html>

