<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Grocery Planner</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
html, body {height:100%; margin:0; font-family:'Segoe UI', sans-serif;
  background: url('https://images.unsplash.com/photo-1586190848861-99aa4a171e90?auto=format&fit=crop&w=1600&q=80') no-repeat center center fixed;
  background-size: cover; color:#333;
}
header {
  background: rgba(40,167,69,0.9); color:white; width:100%;
  position:sticky; top:0; z-index:10;
}
.main-container {
  display:flex; flex-direction:column; align-items:center;
  padding:30px; min-height:calc(100vh-80px); overflow-y:auto;
  backdrop-filter: blur(8px);
}
.form-container {
  background: rgba(255,255,255,0.9); padding:30px; border-radius:20px;
  box-shadow:0 8px 30px rgba(0,0,0,0.3); width:100%; max-width:500px;
  animation: fadeIn 1s ease; margin-bottom:40px;
}
@keyframes fadeIn {from{opacity:0; transform: translateY(-20px);}to{opacity:1; transform: translateY(0);}}
button { transition: transform 0.2s; } button:hover { transform: scale(1.05); }
#dailyItemsContainer {
  display:grid; grid-template-columns:repeat(auto-fill, minmax(220px,1fr));
  gap:20px; width:100%; max-width:1200px;
}
.item-card {
  background: rgba(255,255,255,0.95); border-radius:15px; padding:20px;
  box-shadow:0 6px 20px rgba(0,0,0,0.25); text-align:center;
  animation: slideIn 0.5s ease;
}
@keyframes slideIn {from{opacity:0; transform: translateY(20px);}to{opacity:1; transform: translateY(0);}}
.form-control, .form-select {border-radius:10px;}
</style>
</head>
<body>

<header class="d-flex justify-content-between align-items-center p-3 rounded shadow-sm mb-4">
  <h1 class="h4 mb-0">Daily Grocery Planner</h1>
  <button class="btn btn-light btn-sm fw-bold" onclick="window.location.href='index.html'">üè† Home</button>
</header>

<div class="main-container">
  <div class="form-container">
    <h3 class="text-center mb-3">Add Daily Item</h3>
    <input type="text" id="dailyItemName" class="form-control mb-3" placeholder="Item Name">
    <div class="d-flex mb-3">
      <input type="number" id="dailyQtyValue" class="form-control me-2" placeholder="Quantity" min="1">
      <select id="dailyQtyUnit" class="form-select">
        <option value="kg">kg</option>
        <option value="grams">grams</option>
        <option value="litres">litres</option>
        <option value="ml">ml</option>
        <option value="packets">packets</option>
        <option value="pieces">pieces</option>
      </select>
    </div>
    <input type="number" id="dailyPrice" class="form-control mb-3" placeholder="Price (‚Çπ)" min="1">
    <input type="date" id="dailyDate" class="form-control mb-3">
    <button class="btn btn-success w-100" onclick="addDailyItem()">‚ûï Add Item</button>
  </div>

  <div id="dailyItemsContainer"></div>
</div>

<script>
const apiUrl = "http://localhost:8080/api/grocery";

// Format date dd/MM/yyyy
function formatDate(dateStr){
  if(!dateStr) return "N/A";
  const d = new Date(dateStr);
  if(isNaN(d)) return "N/A";
  return `${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}/${d.getFullYear()}`;
}

// Render daily items
async function renderDailyItems() {
  try {
    const res = await fetch(apiUrl);
    const allItems = await res.json();
    const dailyItems = allItems.filter(i => i.source === "Daily");
    const container = document.getElementById("dailyItemsContainer");

    if(dailyItems.length === 0) {
      container.innerHTML = `<p class="text-center fw-bold">No daily items yet!</p>`;
      return;
    }

    container.innerHTML = dailyItems.map(i=>`
      <div class="item-card">
        <strong>${i.name}</strong><br>
        Quantity: ${i.quantity} ${i.unit}<br>
        Price: ‚Çπ${i.price}<br>
        Source: ${i.source || 'N/A'}<br>
        Date: ${formatDate(i.date)}
      </div>
    `).join("");
  } catch(err){
    console.error("Failed to fetch daily items:", err);
  }
}

// Add daily item
async function addDailyItem(){
  const name = document.getElementById("dailyItemName").value.trim();
  const quantity = parseFloat(document.getElementById("dailyQtyValue").value);
  const unit = document.getElementById("dailyQtyUnit").value;
  const price = parseFloat(document.getElementById("dailyPrice").value);
  const date = document.getElementById("dailyDate").value || new Date().toISOString().split('T')[0];

  if(!name || !quantity || !price){
    alert("Enter valid name, quantity & price.");
    return;
  }

  const item = { name, quantity, unit, price, source:"Daily", date };

  try{
    const res = await fetch(apiUrl, {
      method:"POST",
      headers: { "Content-Type":"application/json" },
      body: JSON.stringify(item)
    });
    if(res.ok){
      alert("‚úÖ Item added successfully!");
      document.getElementById("dailyItemName").value="";
      document.getElementById("dailyQtyValue").value="";
      document.getElementById("dailyPrice").value="";
      document.getElementById("dailyDate").value="";
      renderDailyItems();
    } else {
      alert("‚ùå Failed to add item");
    }
  } catch(err){
    console.error(err);
    alert("‚ùå Failed to add item");
  }
}

// Initial render
renderDailyItems();
</script>
</body>
</html>

