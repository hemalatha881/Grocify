<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Seasonal Grocery Planner</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { font-family:'Segoe UI',sans-serif; margin:0; background:#f5f5f5; }
.header { position: fixed; top:0; left:0; right:0; z-index:1000; background: #28a745; color:white; padding:15px; display:flex; justify-content:space-between; align-items:center; }
.header h5 { margin:0; }
.main { padding-top:90px; }
.season-bg { width:100%; height:200px; background-size:cover; background-position:center; border-radius:10px; margin-bottom:20px; }
.item-cards { display:grid; grid-template-columns:repeat(auto-fill,minmax(180px,1fr)); gap:15px; }
.item-card { background:white; border-radius:12px; padding:15px; text-align:center; box-shadow:0 4px 12px rgba(0,0,0,0.2); transition:0.3s; }
.item-card:hover { transform:scale(1.05); }
.modal-content { border-radius:15px; }
#addedItems { margin-top:30px; }
</style>
</head>
<body>

<div class="header">
  <h5>Seasonal Grocery Planner</h5>
  <div>
    <button class="btn btn-light btn-sm me-2" onclick="window.location.href='index1.html'">üè† Home</button>
  </div>
</div>

<div class="main container">
  <div class="mb-3 d-flex gap-2 flex-wrap">
    <button class="btn btn-outline-success" onclick="showSeason('spring')">Spring</button>
    <button class="btn btn-outline-warning" onclick="showSeason('summer')">Summer</button>
    <button class="btn btn-outline-primary" onclick="showSeason('rainy')">Rainy</button>
    <button class="btn btn-outline-danger" onclick="showSeason('autumn')">Autumn</button>
    <button class="btn btn-outline-info" onclick="showSeason('winter')">Winter</button>
  </div>

  <div id="seasonBackground" class="season-bg"></div>
  <div id="seasonOutput" class="item-cards"></div>

  <h5 class="mt-4">Added Items</h5>
  <ul class="list-group" id="addedItems">
    <li class="list-group-item">No items added yet.</li>
  </ul>
</div>

<!-- Modal -->
<div class="modal" id="popupCard" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-sm">
    <div class="modal-content p-3">
      <h5 id="popupItem" class="mb-3 text-center"></h5>
      <label>Quantity:</label>
      <input type="number" id="popupQtyValue" min="1" class="form-control mb-2">
      <select id="popupQtyUnit" class="form-select mb-2">
        <option value="kg">kg</option>
        <option value="grams">grams</option>
        <option value="litres">litres</option>
        <option value="ml">ml</option>
        <option value="packets">packets</option>
        <option value="pieces">pieces</option>
      </select>
      <label>Price (‚Çπ):</label>
      <input type="number" id="popupPrice" min="1" class="form-control mb-2">
      <label>Date:</label>
      <input type="date" id="popupDate" class="form-control mb-3">
      <button class="btn btn-success w-100" onclick="confirmAdd()">Add Item</button>
    </div>
  </div>
</div>

<script>
const apiUrl = "http://localhost:8080/api/grocery";

const seasonalData = {
  spring: {
    bg:"https://images.pexels.com/photos/1043458/pexels-photo-1043458.jpeg",
    items:["Asparagus","Peas","Spinach","Radish","Carrot","Cucumber","Methi","Beans","Mango (early)","Watermelon","Strawberries","Papaya","Muskmelon","Pineapple","Mint","Coriander","Curry leaves","Fish","Chicken","Paneer","Curd","Sprouts","Lettuce","Tomato","Broccoli"]
  },
  summer: {
    bg:"https://images.unsplash.com/photo-1507525428034-b723cf961d3e",
    items:["Bottle gourd","Ridge gourd","Okra","Bitter gourd","Cucumber","Brinjal","Cluster beans","Mango","Muskmelon","Watermelon","Litchi","Papaya","Jamun","Jackfruit","Cherries","Tulsi","Mint","Fennel seeds","Buttermilk","Curd","Moong dal","Eggs","Tomatoes","Cabbage","Carrots","Spinach"]
  },
  rainy: {
    bg:"https://static.vecteezy.com/system/resources/thumbnails/060/146/880/small_2x/rain-drops-on-leaf-and-stone-creating-a-peaceful-wet-scene-photo.jpg",
    items:["Bitter gourd","Snake gourd","Arbi","Yam","Pumpkin","Beans","Drumstick","Jamun","Guava","Custard apple","Pomegranate","Cherries","Pear","Banana","Ginger","Turmeric","Garlic","Hing","Ajwain","Dal varieties","Sprouts","Paneer","Boiled eggs","Cucumber","Bottle gourd","Okra","Spinach"]
  },
  autumn: {
    bg:"https://images.pexels.com/photos/1741696/pexels-photo-1741696.jpeg",
    items:["Pumpkin","Brinjal","Beetroot","Carrot","Sweet potato","Capsicum","Spinach","Apple","Pomegranate","Pear","Papaya","Chikoo","Grapes","Tulsi","Ajwain","Fennel","Cumin","Fish","Mutton","Chicken","Paneer","Lentils","Cauliflower","Cabbage","Tomato"]
  },
  winter: {
    bg:"https://wallpapers.com/images/featured/winter-season-pictures-t6jheosv0awzd74t.jpg",
    items:["Cauliflower","Cabbage","Spinach","Methi","Turnip","Peas","Radish","Carrot","Mustard greens","Oranges","Kinnow","Apple","Grapes","Guava","Dates","Strawberry","Dry fruits","Ginger","Garlic","Turmeric","Mustard seeds","Paneer","Milk","Nuts","Chicken","Mutton","Fish","Pumpkin","Brinjal","Beetroot","Carrot"]
  }
};

let currentItem = "";

// Show season items
function showSeason(season){
  document.getElementById("seasonBackground").style.backgroundImage = `url('${seasonalData[season].bg}')`;
  const container = document.getElementById("seasonOutput");
  container.innerHTML = seasonalData[season].items.map(item=>`
    <div class="item-card">
      <strong>${item}</strong><br>
      <button class="btn btn-sm btn-success mt-2" onclick="openPopup('${item}')">‚ûï Add</button>
    </div>
  `).join("");
}

// Open modal
function openPopup(item){
  currentItem = item;
  document.getElementById("popupItem").textContent = `Add ${item}`;
  document.getElementById("popupQtyValue").value = 1;
  document.getElementById("popupQtyUnit").value = "kg";
  document.getElementById("popupPrice").value = "";
  document.getElementById("popupDate").value = new Date().toISOString().split("T")[0];
  new bootstrap.Modal(document.getElementById("popupCard")).show();
}

// Add item
async function confirmAdd(){
  const qty = parseFloat(document.getElementById("popupQtyValue").value);
  const unit = document.getElementById("popupQtyUnit").value;
  const price = parseFloat(document.getElementById("popupPrice").value);
  const date = document.getElementById("popupDate").value || new Date().toISOString().split("T")[0];

  if(!qty || !price){ alert("Enter valid quantity & price"); return; }

  const item = { 
    name: currentItem, 
    quantity: qty, 
    unit: unit, 
    price: price, 
    date: date, 
    source: "Seasonal" 
  };

  try{
    const res = await fetch(apiUrl,{
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify(item)
    });
    if(!res.ok) throw new Error("Failed");
    renderAddedItems();
    const modalEl = document.getElementById("popupCard");
    bootstrap.Modal.getInstance(modalEl).hide();
  }catch(err){
    console.error(err); 
    alert("Failed to add item. Check backend!");
  }
}

// Render added items
async function renderAddedItems(){
  try{
    const res = await fetch(apiUrl);
    const data = await res.json();
    const seasonalItems = data.filter(i=>i.source === "Seasonal");
    const ul = document.getElementById("addedItems");
    if(seasonalItems.length === 0){
      ul.innerHTML = "<li class='list-group-item'>No items added yet.</li>";
      return;
    }
    ul.innerHTML = seasonalItems.map(i=>`
      <li class="list-group-item">
        <strong>${i.name}</strong><br>
        Quantity: ${i.quantity} ${i.unit}<br>
        Price: ‚Çπ${i.price}<br>
        Date: ${new Date(i.date).toLocaleDateString('en-GB')}
      </li>
    `).join("");
  }catch(err){ console.error(err); }
}

window.addEventListener("load", renderAddedItems);
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
